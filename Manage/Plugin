#!/bin/env bash
black="\e[30m"
red="\033[31m"
green="\033[32m"
yellow="\033[33m"
blue="\033[34m"
purple="\033[35m"
cyan="\033[36m"
white="\033[37m"
background="\033[0m"

GithubMirrorSource="https://gh.arcticfox.top"
GithubMirror="https://mirrors.chenby.cn"
function MenuSize(){
HEIGHT=$(($(tput lines) - 10))
WIDTH=$(($(tput cols) - 10))
OPTION=$((${HEIGHT} - 8))
if (( $HEIGHT <= 8 ));then
  echo -e ${blue}[${red}*${blue}] ${cyan}æ‚¨çš„å±å¹•é«˜åº¦è¿‡ä½Ž.${background}
  exit
fi
if (( $WIDTH <= 0 ));then
  echo -e ${blue}[${red}*${blue}] ${cyan}æ‚¨çš„å±å¹•å®½åº¦åº¦è¿‡çª„.${background}
  exit
fi
}

function MsgboxSize(){
HEIGHT=$(($(tput lines) - 30))
WIDTH=$(($(tput cols) - 10))
if (( $HEIGHT <= 0 ));then
  echo -e ${blue}[${red}*${blue}] ${cyan}æ‚¨çš„å±å¹•é«˜åº¦è¿‡ä½Ž.${background}
  exit
fi
if (( $WIDTH <= 0 ));then
  echo -e ${blue}[${red}*${blue}] ${cyan}æ‚¨çš„å±å¹•å®½åº¦åº¦è¿‡çª„.${background}
  exit
fi
}
feedback(){
if [ $? == 1 ]
then
  Main
  exit
fi
}

InstallGitPlugin(){
unset InstalledPlugin Options PackageNameLocal GitLocal PluginFolderCloud
MsgboxSize
if (${TUISoftware} --title "AF-BOT"  \
--yes-button "GhMirror" \
--no-button "Github" \
--yesno "è¯·é€‰æ‹©plugin.yamlæ¥æº\nä¸­å›½å¤§é™†å»ºè®®ä½¿ç”¨GhMirror" \
${HEIGHT} ${WIDTH} \
3>&1 1>&2 2>&3)
then
  echo -e ${cyan}æ­£åœ¨ç¼“å­˜ ${yellow}plugin.yaml${background}
  PluginURl="${GithubMirrorSource}/https://raw.githubusercontent.com/ArcticFox520/Yunzai-Bot-Script/main/Manage/plugin.yaml"
  GitSite=Gitee
  curl -sL ${PluginURl} > plugin.yaml
else
  echo -e ${cyan}æ­£åœ¨ç¼“å­˜ ${yellow}plugin.yaml${background}
  PluginURl="https://raw.githubusercontent.com/ArcticFox520/Yunzai-Bot-Script/main/Manage/plugin.yaml"
  curl -sL ${PluginURl} > plugin.yaml
  GitSite=Github
fi

MsgboxSize
if (${TUISoftware} \
--title "AF-BOT" \
--yes-button "å•é€‰" \
--no-button "å¤šé€‰" \
--yesno "è¯·é€‰æ‹©Gitæ’ä»¶å®‰è£…æ–¹å¼" \
${HEIGHT} ${WIDTH})
then
  MultipleChoice=false
  ChecklistMenu=menu
  unset OFF tips
else
  MultipleChoice=true
  ChecklistMenu=checklist
  OFF=OFF
  tips="[ç©ºæ ¼é€‰æ‹© å›žè½¦ç¡®å®š ç©ºé€‰å–æ¶ˆ]"
fi

GitPlugin=$(yq .GitPlugin plugin.yaml)

for i in $(ls plugins -I example -I genshin -I other -I system)
do
  if [ -e ./plugins/${i}/package.json ]
  then
    PackageName=$(yq .name ./plugins/${i}/package.json)
  fi
  PackageNameLocal="${PackageNameLocal} ${PackageName}"
done

for i in $(ls plugins -I example -I genshin -I other -I system)
do
  if [ -e ./plugins/${i}/.git/config ]
  then
    Git=$(grep url ./plugins/${i}/.git/config | sed 's|url =||g')
  fi
  GitLocal="${GitLocal} ${Git}"
done

unset i
i=0
for PluginFolderCloud in ${GitPlugin}
do
  i=$((${i}+1))
  echo -en '\r'${yellow}æ­£åœ¨å¤„ç†æ’ä»¶æ•°æ® ${green}å·²å¤„ç† ${cyan}${i} é¡¹${background}
  PackageName=$(yq .${PluginFolderCloud}.PackageName plugin.yaml)
  PackageName=$(echo ${PackageName})
  Git=$(yq .${PluginFolderCloud}.Repository plugin.yaml)
  Git=$(echo ${Git} | sed 's|- Github: ||g' | sed 's|- Gitee: ||g')
  if echo ${PackageNameLocal} | grep -q "${PackageName}"
  then
    InstallationStatus="[å·²å®‰è£…]"
    InstalledPlugin="${InstalledPlugin} ${PluginFolderCloud}"
  elif echo ${GitLocal} | grep -q "${Git}"
  then
    InstallationStatus="[å·²å®‰è£…]"
    InstalledPlugin="${InstalledPlugin} ${PluginFolderCloud}"
  elif [ -d ./plugins/${PluginFolderCloud} ]
  then
    InstallationStatus="[å·²å®‰è£…]"
    InstalledPlugin="${InstalledPlugin} ${PluginFolderCloud}"
  else
    InstallationStatus="[æœªå®‰è£…]"
  fi
  Options="${Options} ${PluginFolderCloud} ${InstallationStatus} ${OFF}"
done
echo -e '\n'
MenuSize
PluginName=$(${TUISoftware} \
--title "AF-YZ" \
--${ChecklistMenu} "æ’ä»¶ç®¡ç† ${tips}" \
${HEIGHT} ${WIDTH} ${OPTION} ${Options} \
3>&1 1>&2 2>&3)

PluginName=$(echo ${PluginName} | sed "s|'||g" | sed 's|"||g')

if [ -z "${PluginName}" ]
then
  Main
  return
fi
GitRepositoryCheck(){
Plugin=$1
if [ "$(yq .${Plugin}.Repository[0].Git* plugin.yaml)" != "No" ] && [ "$(yq .${Plugin}.Repository[1].Git* plugin.yaml)" != "No" ]
then
  if [ "${GitSite}" == "Gitee" ]
  then
    GroupNumber=0
    Git="Gitee:"
    PNPMMirror="https://registry.npmmirror.com"
  elif [ "${GitSite}" == "Github" ]
  then
    GroupNumber=1
    Git="Github:"
    PNPMMirror="https://registry.npmjs.org"
  fi
else
  if [ "$(yq .${Plugin}.Repository[0].Git* plugin.yaml)" != "No" ]
  then
    GroupNumber=0
    Git="Gitee:"
    PNPMMirror="https://registry.npmmirror.com"
  elif [ "$(yq .${Plugin}.Repository[1].Git* plugin.yaml)" != "No" ]
  then
    GroupNumber=1
    Git="Github:"
    PNPMMirror="https://registry.npmjs.org"
    if [ "${GitSite}" == "Gitee" ]
    then
      GhMirror="${GithubMirror}/"
    elif [ "${GitSite}" == "Github" ]
    then
      unset GhMirror 
    fi
  fi
fi
}

if [ ${MultipleChoice} == true ]
then
  for Plugin in ${PluginName[@]}
  do
    GitRepositoryCheck ${Plugin}
    GitURL=$(yq .${Plugin}.Repository[${GroupNumber}] plugin.yaml | sed "s|${Git}||g")
    Author=$(yq .${Plugin}.Author plugin.yaml)
    if ! echo ${InstalledPlugin} | grep -q ${Plugin}
    then
      echo -e ${white}==================================${background}
      echo -e ${cyan}æ­£åœ¨å®‰è£…: ${yellow}${Plugin} ${cyan}ç¨å®‰å‹¿èº~${background}
      echo -e ${cyan}ä½œè€…: ${yellow}${Author}${background}
      echo -e ${white}==================================${background}
      echo -e ${cyan}æ­£åœ¨å…‹éš†æ’ä»¶${background}
      if git clone --depth=1 ${GhMirror}${GitURL} ./plugins/${Plugin}
      then
        if [ -e ./plugins/${Plugin}/package.json ]
        then
          echo -e ${cyan}æ­£åœ¨å®‰è£…ä¾èµ–${background}
          if pnpm install --registry=${PNPMMirror}
          then
            echo -e ${cyan}ä¾èµ–å®‰è£… ${green}æˆåŠŸ ${background}
          else
            echo -e ${cyan}ä¾èµ–å®‰è£… ${red}å¤±è´¥ ${yellow}è·³è¿‡${background}
          fi
        fi
      else
        echo -e ${cyan}æ’ä»¶å…‹éš† ${red}å¤±è´¥ ${yellow}è·³è¿‡${background}
      fi
    else
      echo -e ${cyan}${Plugin}æ’ä»¶å·²å®‰è£… ${yellow}è·³è¿‡${background}
    fi
  done
  echo -en ${cyan}æ‰€æœ‰æ’ä»¶ ${green}å®‰è£…å®Œæˆ ${cyan}å›žè½¦è¿”å›ž${background};read
  Main
elif [ ${MultipleChoice} == false ]
then
  GitRepositoryCheck ${PluginName}
  GitURL=$(yq .${PluginName}.Repository[${GroupNumber}] plugin.yaml | sed "s|${Git}||g")
  Author=$(yq .${PluginName}.Author plugin.yaml)
  if ! echo ${InstalledPlugin} | grep -q ${PluginName}
  then
    echo -e ${white}==================================${background}
    echo -e ${cyan}æ­£åœ¨å®‰è£…: ${yellow}${PluginName} ${cyan}ç¨å®‰å‹¿èº~${background}
    echo -e ${cyan}æ’ä»¶ä½œè€…: ${yellow}${Author}${background}
    echo -e ${white}==================================${background}
    echo -e ${cyan}æ­£åœ¨å…‹éš†æ’ä»¶${background}
    echo git clone --depth=1 ${GhMirror}${GitURL} ./plugins/${PluginName}
    if git clone --depth=1 ${GhMirror}${GitURL} ./plugins/${PluginName}
    then
      if [ -e ./plugins/${PluginName}/package.json ]
      then
        echo -e ${cyan}æ­£åœ¨å®‰è£…ä¾èµ–${background}
        if pnpm install --registry=${PNPMMirror}
        then
          echo -e ${cyan}ä¾èµ–å®‰è£… ${green}æˆåŠŸ ${background}
          echo -en ${cyan}å›žè½¦è¿”å›ž${background};read
        else
          echo -e ${cyan}ä¾èµ–å®‰è£… ${red}å¤±è´¥${background}
          echo -en ${cyan}å›žè½¦è¿”å›ž${background};read
        fi
      fi
    else
      echo -e ${cyan}æ’ä»¶å…‹éš† ${red}å¤±è´¥${background}
      echo -en ${cyan}å›žè½¦è¿”å›ž${background};read
      Main
    fi
  else
    MsgboxSize
    ${TUISoftware} --title "AF-YZ" \
    --msgbox "${Plugin} å·²å®‰è£…" \
    ${HEIGHT} ${WIDTH}
  fi
fi
}

InstallJSPlugin(){
MenuSize
Number=$(${TUISoftware} \
--title "AF-YZ" \
--menu "JSæ’ä»¶å®‰è£…" \
${HEIGHT} ${WIDTH} ${OPTION} \
"1" "æºç ç›´é“¾" \
"2" "Gitç½‘é¡µé“¾æŽ¥" \
"0" "è¿”å›ž/é€€å‡º" \
3>&1 1>&2 2>&3)
case ${Number} in
1)
  echo -en ${green}è¯·è¾“å…¥é“¾æŽ¥: ${background};read JSURL
  if [[ ${JSURL} != https://* ]] && [[ ${JSURL} != *.js ]];then
    echo -e ${red}è¾“å…¥é”™è¯¯${background}
    echo -en ${cyan}å›žè½¦è¿”å›ž${background};read
    return
  fi
  JSFile=`echo ${JSURL} | awk -F/ '{print $NF}'`
  curl -sL ${JSURL} > plugins/example/${JSFile}
  echo -en ${cyan}å®‰è£…å®Œæˆ å›žè½¦è¿”å›ž${background};read
  Main
;;
2)
  echo -en ${green}è¯·è¾“å…¥é“¾æŽ¥: ${background};read JSURL
  if [[ ${JSURL} == *git* ]] && [[ ${JSURL} == *.js ]]
  then
  JSFile=`echo ${JSURL} | awk -F/ '{print $NF}'`
    if [[ ${JSURL} = *github* ]]
    then
      JSURL=$(echo ${JSURL} | sed "s|blob/||g" | sed "s|github|raw.githubusercontent|g")
      curl -sL ${GitHubMirror}/${JSURL} > plugins/example/${JSFile}
    elif [[ ${JSURL} = *gitee* ]]
    then
      JSURL=$(echo ${JSURL} | sed 's|blob|raw|g')
      curl -sL ${JSURL} > plugins/example/${JSFile}
    fi
    echo -en ${cyan}å®‰è£…å®Œæˆ å›žè½¦è¿”å›ž${background};read
    Main
  else
    echo -e ${red}é”™è¯¯ é“¾æŽ¥ä¸æ¥è‡³äºŽGitä»“åº“${background}
    echo -en ${cyan}å›žè½¦è¿”å›ž${background};read
    Main
  fi
;;
esac
}
UpdateGitPlugin(){
git_pull(){
echo -e ${yellow}æ­£åœ¨æ›´æ–° ${folder}${background}
if ! git pull -f
then
  echo -en ${red}${folder}æ›´æ–°å¤±è´¥ ${yellow}æ˜¯å¦å¼ºåˆ¶æ›´æ–° [Y/N]${background};read YN
  case ${YN} in
  Y|y)
    remote=$(grep 'remote =' .git/config | sed 's/remote =//g')
    remote=$(echo ${remote})
    branch=$(grep branch .git/config | sed "s/\[branch \"//g" | sed 's/"//g' | sed "s/\]//g")
    branch=$(echo ${branch})
    git fetch --all
    git reset --hard ${remote}/${branch}
    git_pull
  esac
fi
}
folder=${BotName}
git_pull
for folder in $(ls plugins)
do
  if [ -d plugins/${folder}/.git ];then
    cd plugins/${folder}
    git_pull ${folder}
    cd ../../
  fi
done
echo -e ${yellow}æ­£åœ¨æ›´æ–°NPM${background}
npm install -g npm@latest
echo -e ${yellow}æ­£åœ¨æ›´æ–°PNPM${background}
pnpm install -g pnpm@latest
echo -en ${cyan}æ›´æ–°å®Œæˆ å›žè½¦è¿”å›ž${background};read
Main
}

DeleteGitPlugin(){
unset PluginName Options PluginList
MsgboxSize
if (${TUISoftware} \
--title "AF-BOT" \
--yes-button "å•é€‰" \
--no-button "å¤šé€‰" \
--yesno "è¯·é€‰æ‹©Gitæ’ä»¶åˆ é™¤æ–¹å¼" \
${HEIGHT} ${WIDTH})
then
  MultipleChoice=false
  ChecklistMenu=menu
  unset OFF tips
else
  MultipleChoice=true
  ChecklistMenu=checklist
  OFF=OFF
  tips="[ç©ºæ ¼é€‰æ‹© å›žè½¦ç¡®å®š ç©ºé€‰å–æ¶ˆ]"
fi
PluginFolder=$(ls -I example -I bin -I other -I system -I genshin plugins/)
for i in ${PluginFolder[@]}
do
  Options="${Options} ${i} ðŸ¥ ${OFF}"
done
MenuSize 
PluginList=$(${TUISoftware} \
--title "AF-YZ" \
--${ChecklistMenu} "æ’ä»¶åˆ é™¤ ${tips}" \
${HEIGHT} ${WIDTH} ${OPTION} ${Options} \
3>&1 1>&2 2>&3)
if [ -z "${PluginList}" ]
then
  Main
  return
fi
if [ "${MultipleChoice}" == "false" ]
then
  if (${TUISoftware} \
  --title "AF-BOT" \
  --yes-button "åˆ é™¤" \
  --no-button "è¿”å›ž" \
  --yesno "æ˜¯å¦åˆ é™¤ ${PluginList}" \
  ${HEIGHT} ${WIDTH})
  then
    echo -e ${yellow}æ­£åœ¨åˆ é™¤ ${cyan}${PluginList}${background}
    rm -rf plugins/${PluginList}
  else
    return
  fi
else
  for i in ${PluginList[@]}
  do
    echo -e ${yellow}æ­£åœ¨åˆ é™¤ ${cyan}${i}${background}
    rm -rf plugins/${i} > /dev/null 2>&1
    rm -rf plugins/${i} > /dev/null 2>&1
  done
  echo -e ${yellow}åˆ é™¤ä»»åŠ¡ ${green}æ‰§è¡Œå®Œæˆ${background}
fi
echo -en ${cyan}å‘½ä»¤æ‰§è¡Œå®Œæˆ å›žè½¦è¿”å›ž${background};read
Main
}

DeleteJSPlugin(){
unset PluginName Options PluginList
MsgboxSize
if (${TUISoftware} \
--title "AF-BOT" \
--yes-button "å•é€‰" \
--no-button "å¤šé€‰" \
--yesno "è¯·é€‰æ‹©JSæ’ä»¶åˆ é™¤æ–¹å¼" \
${HEIGHT} ${WIDTH})
then
  MultipleChoice=false
  ChecklistMenu=menu
  unset OFF tips
else
  MultipleChoice=true
  ChecklistMenu=checklist
  OFF=OFF
  tips="[ç©ºæ ¼é€‰æ‹© å›žè½¦ç¡®å®š ç©ºé€‰å–æ¶ˆ]"
fi
PluginFolder=$(ls plugins/example/)
for i in ${PluginFolder[@]}
do
  Options="${Options} ${i} ðŸ¥ ${OFF}"
done
MenuSize 
PluginList=$(${TUISoftware} \
--title "AF-YZ" \
--${ChecklistMenu} "æ’ä»¶åˆ é™¤ ${tips}" \
${HEIGHT} ${WIDTH} ${OPTION} ${Options} \
3>&1 1>&2 2>&3)
if [ -z "${PluginList}" ]
then
  Main
  return
fi
if [ "${MultipleChoice}" == "true" ]
then
  if (${TUISoftware} \
  --title "AF-BOT" \
  --yes-button "åˆ é™¤" \
  --no-button "è¿”å›ž" \
  --yesno "æ˜¯å¦åˆ é™¤ ${PluginList}" \
  ${HEIGHT} ${WIDTH})
  then
    echo -e ${yellow}æ­£åœ¨åˆ é™¤ ${cyan}${PluginList}${background}
    rm -rf plugins/example/${PluginList}
  else
    Main
    return
  fi
else
  for i in ${PluginList[@]}
  do
    echo -e ${yellow}æ­£åœ¨åˆ é™¤ ${cyan}${i}${background}
    rm -rf plugins/example/${i} > /dev/null 2>&1
    rm -rf plugins/example/${i} > /dev/null 2>&1
  done
  echo -e ${yellow}åˆ é™¤ä»»åŠ¡ ${green}æ‰§è¡Œå®Œæˆ${background}
fi
echo -en ${cyan}å‘½ä»¤æ‰§è¡Œå®Œæˆ å›žè½¦è¿”å›ž${background};read
Main
}


function Main(){
MenuSize
Number=$(${TUISoftware} \
--title "AF-YZ" \
--menu "æ’ä»¶ç®¡ç†" \
${HEIGHT} ${WIDTH} ${OPTION} \
"1" "å®‰è£…GITæ’ä»¶" \
"2" "å®‰è£…JSæ’ä»¶" \
"3" "æ›´æ–°GITæ’ä»¶" \
"4" "åˆ é™¤GITæ’ä»¶" \
"5" "åˆ é™¤JSæ’ä»¶" \
"0" "è¿”å›ž/é€€å‡º" \
3>&1 1>&2 2>&3)
if [ "$?" = "1" ]
  then
    exit
fi
case ${Number} in
1)
  InstallGitPlugin
  ;;
2)
  InstallJSPlugin
  ;;
3)
  UpdateGitPlugin
  ;;
4)
  DeleteGitPlugin
  ;;
5)
  DeleteJSPlugin
  ;;
0)
  exit
  ;;
esac
}

CheckPath(){
if [ -d "./plugins" ];then
  PluginPath="."
  cd ${PluginPath}
elif [ -d "../plugins" ];then
  PluginPath=".."
  cd ${PluginPath}
else
  MenuSize
  Number=$(${TUISoftware} \
  --title "ç™½ç‹ QQç¾¤:705226976" \
  --menu "è¯·é€‰æ‹©æ‚¨è¦ä¸ºå“ªä¸€ä¸ªbotç®¡ç†æ’ä»¶" \
  ${HEIGHT} ${WIDTH} ${OPTION} \
  "1" "Miao-Yunzai" \
  "2" "TRSS-Yunzai" \
  "3" "åˆ‡æ¢CLIèœå•" \
  "0" "é€€å‡º" \
  3>&1 1>&2 2>&3)
  case ${Number} in 
  1)
    BotName="Miao-Yunzai"
  ;;
  2)
    BotName="TRSS-Yunzai"
  ;;
  3)
    exit 0
  ;;
  esac
  if [ -d "/root/${BotName}/node_modules" ];then
    PluginPath="/root/${BotName}"
    cd ${PluginPath}
  elif [ -d "/root/.fox@bot/${BotName}/node_modules" ];then
    PluginPath="/root/.fox@bot/${BotName}"
    cd ${PluginPath}
  elif [ -d "/home/lighthouse/ubuntu/${BotName}/node_modules" ];then
    PluginPath="/home/lighthouse/ubuntu/${BotName}"
    cd ${PluginPath}
  elif [ -d "/home/lighthouse/centos/${BotName}/node_modules" ];then
    PluginPath="/home/lighthouse/centos/${BotName}"
    cd ${PluginPath}
  elif [ -d "/home/lighthouse/debian/${BotName}/node_modules" ];then
    PluginPath="/home/lighthouse/debian/${BotName}"
    cd ${PluginPath}
  elif [ -d "/root/TRSS_AllBot/${BotName}/node_modules" ];then
    PluginPath="/root/TRSS_AllBot/${BotName}"
    cd ${PluginPath}
  else
    MsgboxSize
    ${TUISoftware} --title "AF-BOT" \
    --msgbox "è‡ªåŠ¨åˆ¤æ–­è·¯å¾„å¤±è´¥ \nè¯·è¿›å…¥${BotName}ç›®å½•åŽ ä½¿ç”¨æœ¬è„šæœ¬" ${HEIGHT} ${WIDTH}
    exit
  fi
fi
}
LinuxInstallPkg(){
if [ $(command -v apt) ];then
    pkg_install="apt install -y"
elif [ $(command -v pacman) ];then
    pkg_install="pacman -Syy --noconfirm --needed"
fi
function pkg_install(){
i=0
echo -e ${yellow}æœªå®‰è£…${pkg} å¼€å§‹å®‰è£…${background}
if [ ! -z "$1" ];then
    pkg="$1"
fi
until ${pkg_install} ${pkg}
do
    if [ "${i}" == "3" ]
        then
            echo -e ${red}é”™è¯¯æ¬¡æ•°è¿‡å¤š é€€å‡º${background}
            exit
    fi
    i=$((${i}+1))
    echo -en ${red}å‘½ä»¤æ‰§è¡Œå¤±è´¥ ${green}3ç§’åŽé‡è¯•${background}
    sleep 3s
    echo
done
}
pkg_list=("curl" "git")
for package in ${pkg_list[@]}
do
  if [ -x "$(command -v pacman)" ];then
    if ! pacman -Qs "${package}" > /dev/null 2>&1;then
      pkg="${package} ${pkg}"
    fi
  elif [ -x "$(command -v apt)" ];then
    if ! dpkg -s "${package}" > /dev/null 2>&1;then
      pkg="${package} ${pkg}"
    fi
  fi
done
if [ ! -z "${pkg}" ]; then
  if [ -x "$(command -v pacman)" ];then
    if ! pacman -Qs "${package}" > /dev/null 2>&1;then
        pkg_install
    fi
  elif [ -x "$(command -v apt)" ];then
    if ! dpkg -s "${package}" > /dev/null 2>&1;then
        apt update
        pkg_install
    fi
  fi
fi
}
NotLinux(){
  if [ ! -x "$(command -v curl)" ];then
    echo -e ${cyan}æ£€æµ‹åˆ°æœªå®‰è£…${red}curl${background}
    exit
  fi
  if [ ! -x "$(command -v git)" ];then
    echo -e ${cyan}æ£€æµ‹åˆ°æœªå®‰è£…${red}git${background}
    exit
  fi
  
}
PnpmInstall(){
if [ ! -x "$(command -v pnpm)" ];then
  echo -e ${cyan}æ£€æµ‹åˆ°æœªå®‰è£…pnpm å¼€å§‹å®‰è£…${background}
  if [ ! -x "$(command -v npm)" ];then
    echo -e ${red}æœªå®‰è£…npm${background}
    exit
  fi
  npm install -g pnpm --registry=https://registry.npmmirror.com
fi
}
SelectPage(){
if [ -x "$(command -v whiptail)" ];then
  TUISoftware=whiptail
  ChoosePage=TUI_Page
elif [ -x "$(command -v dialog)" ];then
  TUISoftware=dialog
  ChoosePage=TUI_Page
fi
}
if [ -e "/etc/issue" ];then
    LinuxInstallPkg
    PnpmInstall
    SelectPage
    CheckPath
    Main
elif [ -e "/etc/os-release" ];then
    LinuxInstallPkg
    PnpmInstall
    SelectPage
    CheckPath
    Main
else
    NotLinux
    SelectPage
    CheckPath
    Main
fi
function MainWhile(){
while true
do
  Main
  if [ "$?" = "1" ]
  then
    break
  fi
done
}
MainWhile
